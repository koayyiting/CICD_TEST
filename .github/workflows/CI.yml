#Trigger when there is a push to main
name: Continuous Integration

on:
  push:
  
jobs:
  # Set up necessary installs
  Build_SetUp:
    name: Build SetUp
    runs-on: ubuntu-latest
    steps:
      - name: Set Up Go
        uses: actions/setup-go@v5  # Setup Go after checkout
        with:
          go-version: '1.21.x'
          cache-dependency-path: subdir/go.sum

      # [Edit] Retrieving from Development Repository
      - name: Checkout Development
        uses: actions/checkout@v4

      - name: Install dependencies
        run: |
          go mod download
  
      # [Edit] Test Cases
      - name: Run Go Files
        working-directory: ./microservices
        run: |
          for dir in ./*/; do
            go build -v "$dir"
          done
          
      - name: Run Go Test Files
        working-directory: ./tests
        run: |
          go test -v -coverprofile=coverage.out ./...
          
      - name: Test
        uses: robherley/go-test-action@v0.1.0
        
      - name: Upload Coverage Report
        uses: actions/upload-artifact@v3
        with:
          name: TDD Coverage Report
          path: coverage.out
